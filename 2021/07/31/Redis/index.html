<!DOCTYPE HTML>
<html lang="zh-CN">



<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Redis, 瀚77的博客">
    <meta name="description" content="本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Redis | 瀚77的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="瀚77的博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>








<body>

    

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">瀚77的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">瀚77的博客</div>
        <div class="logo-desc">
            
            本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/11.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Redis</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Redis/" class="post-category">
                                Redis
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-07-31
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-08-12
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    17.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    69 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="NoSQL数据库简介"><a href="#NoSQL数据库简介" class="headerlink" title="NoSQL数据库简介"></a>NoSQL数据库简介</h2><h3 id="技术发展"><a href="#技术发展" class="headerlink" title="技术发展"></a>技术发展</h3><ul>
<li>解决功能性问题：java，jsp，tomcat，html，Linux</li>
<li>解决扩展性的问题：Spring、SpringMVC、MyBatis</li>
<li>解决性能问题：NoSQL，java线程，Nginx</li>
</ul>
<h3 id="NoSQL简介"><a href="#NoSQL简介" class="headerlink" title="NoSQL简介"></a>NoSQL简介</h3><p>NoSQL（==Not Only SQL==），意为“不仅仅是SQL”，泛指<strong>非关系型数据库</strong>。</p>
<p>NoSQL不依赖业务逻辑方式存储，而以简单的key–value模式存储，因此大大的增加了数据库的扩展能力。</p>
<p><strong>其打破了传统的关系型数据库以业务逻辑为依据进行的存储方式，而是针对不同数据结构类型，改变以性能为优先的存储方式</strong></p>
<p>特点：</p>
<ul>
<li>不遵循SQL标准</li>
<li>远超于SQL性能，因为不依赖业务逻辑，只是单纯的key–value</li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>对数据高并发的读写，比如秒杀</li>
<li>海量数据的读写</li>
<li>对数据的高可扩展性 </li>
</ul>
<h3 id="不适用场景"><a href="#不适用场景" class="headerlink" title="不适用场景"></a>不适用场景</h3><ul>
<li>需要事务支持</li>
<li>基于sql的结构化查询存储，处理复杂的关系</li>
</ul>
<p>简言之一句话：==<strong>用不着sql的和用了sql也不行的情况，请考虑用NoSQL</strong>==</p>
<p>行式存储数据库：每一行都当做一块来存储，优势：查询数据很快等</p>
<p>列式存储数据库：每一列都当做一块来存储，优势：求平均值很快等</p>
<p>【补充：】</p>
<p>1TB (Trillionbyte 万亿字节 太字节)=1024GB</p>
<p>1PB（Petabyte 千万亿字节 拍字节）=1024TB，</p>
<p>1EB（Exabyte 百亿亿字节 艾字节）=1024PB，</p>
<p>1ZB (Zettabyte 十万亿亿字节 泽字节)= 1024 EB,</p>
<p>1YB (Jottabyte 一亿亿亿字节 尧字节)= 1024 ZB,</p>
<p>1BB (Brontobyte 一千亿亿亿字节)= 1024 YB.</p>
<h2 id="Redis-1"><a href="#Redis-1" class="headerlink" title="Redis"></a>Redis</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li><p>Redis是一个开源的key – value存储系统</p>
</li>
<li><p>和Memcached 类似，但它支持存储value类型相对更多，包括string(字符串)，list(链表)，set(集合)，Zset(有序集合) 和hash(哈希类型)</p>
</li>
<li><p>这些数据类型都支持push /pop 、add/remove 及取交集并集和差集以及更丰富的操作，而这些<strong>操作都是原子性的</strong>。</p>
</li>
<li><p>在此基础上，Redis支持各种不同方式的排序</p>
</li>
<li><p>为了保证效率，<strong>数据都是缓存在内存中</strong>。</p>
</li>
<li><p>Redis会周期性的把更新的数据写入磁盘或者把写入、修改操作追加到记录文件。</p>
</li>
<li><p>并且在此基础上实现了master—slave(主从)同步。</p>
</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>配合关系型数据库做高速缓存<ul>
<li>高频次，热门访问的数据，降低数据库IO</li>
<li>分布式架构，做session共享</li>
</ul>
<img src="/images/QQ%E6%88%AA%E5%9B%BE20210803093645.png"></li>
<li>多样的数据结构存储持久化数据</li>
</ul>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210803093707.png"></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li><p>redis-6.2.1.tar.gz  放到  /opt/   下</p>
</li>
<li><p>yum install gcc   下载gcc</p>
</li>
<li><p>tar -zxvf  redis-6.2.1.tar.gz   解压</p>
</li>
<li><p>make   编译为c的文件</p>
</li>
<li><p>make install   安装</p>
</li>
<li><p>默认在  /usr/local/bin</p>
</li>
</ul>
<p>安装目录下各个文件的作用：</p>
<p>redis-benchmark:性能测试工具</p>
<p>redis-check-aof：修复有问题的AOF文件</p>
<p>redis-check-dump：修复有问题的dump.rdb文件</p>
<p>redis-sentinel：Redis集群使用</p>
<p>redis-server：Redis服务器启动命令</p>
<p>redis-cli：客户端，操作入口</p>
<p>前台启动  :  redis–server</p>
<p>后台启动：</p>
<ul>
<li><p>cp  /opt/redis-6.2.5/redis.conf  /etc/redis.conf</p>
</li>
<li><p>vim  /etc/redis.conf    ，把 daemonize   no  改为   daemonize   yes </p>
<p>【补充：】  vim的命令行模式下输入   /daemonize    即可搜索需要的内容</p>
</li>
<li><p>cd  /usr/local/bin/</p>
</li>
<li><p>reids-server  配置文件所在位置        就可以启动服务</p>
</li>
<li><p> redis-cli  [ -p  端口号]                        可以连接客户端</p>
</li>
<li><p>若是要启动多个redis，需要在启动服务的时候表明自己用的是哪个配置文件，还有必须指定自己的端口号</p>
</li>
<li><p>关闭：   redis-cil  shutdown  或者  kill -9  进程号</p>
<p>多实例关闭，指定端口关闭:  redis-cli -p &lt;端口号&gt;shutdown</p>
</li>
</ul>
<h3 id="Redis占用内存大小"><a href="#Redis占用内存大小" class="headerlink" title="Redis占用内存大小"></a>Redis占用内存大小</h3><p>​      我们知道Redis是基于内存的key-value数据库，因为系统的内存大小有限，所以我们在使用Redis的时候可以配置Redis能使用的最大的内存大小</p>
<ul>
<li><p>通过配置文件配置</p>
</li>
<li><p>redis配置文件中，修改    maxmemory  后面的值即可</p>
</li>
<li><p>通过命令修改</p>
<pre class=" language-shell"><code class="language-shell">//设置Redis最大占用内存大小为100M
127.0.0.1:6379> config set maxmemory 100mb
//获取设置的Redis能使用的最大内存大小
127.0.0.1:6379> config get maxmemory
</code></pre>
<p>​    如果不设置最大内存大小或者设置最大内存大小为0，在64位操作系统下不限制内存大小，在32位操作系统下最多使用3GB内存</p>
</li>
</ul>
<h4 id="Redis的内存淘汰"><a href="#Redis的内存淘汰" class="headerlink" title="Redis的内存淘汰"></a>Redis的内存淘汰</h4><p>​    既然可以设置Redis最大占用内存大小，那么配置的内存就有用完的时候。那在内存用完的时候，还继续往Redis里面添加数据不就没内存可用了吗？</p>
<p>实际上Redis定义了几种策略来处理这种情况：</p>
<ul>
<li>noeviction(默认) ： 对于写请求不在提供服务，直接返回错误，DEL请求和部分特殊请求除外</li>
<li>allkeys-lru：从所有key中使用LRU(最近最少使用)算法进行淘汰</li>
<li>volatile-lru：从设置了过期时间的key中使用LRU算法淘汰</li>
<li>allkeys-random：从所有key中随机淘汰</li>
<li>volatile-random：从设置了过期时间的key中随机淘汰</li>
<li>volatile-ttl：在设置了过期时间的key中，根据key 的过期时间进行淘汰，越快过期的越优先淘汰</li>
</ul>
<p>当使用volatile-lru、volatile-random、volatile-ttl这三种策略时，如果没有key可以被淘汰，则和noeviction一样返回错误</p>
<h4 id="设置内存淘汰策略"><a href="#设置内存淘汰策略" class="headerlink" title="设置内存淘汰策略"></a>设置内存淘汰策略</h4><ul>
<li>获取当前内存淘汰策略</li>
</ul>
<pre class=" language-shell"><code class="language-shell">127.0.0.1:6379> config get maxmemory-policy
</code></pre>
<ul>
<li>通过配置文件设置淘汰策略</li>
</ul>
<pre class=" language-shell"><code class="language-shell">maxmemory-policy allkeys-lru
</code></pre>
<ul>
<li>通过命令修改淘汰策略：</li>
</ul>
<pre class=" language-shell"><code class="language-shell">127.0.0.1:6379> config set maxmemory-policy allkeys-lru
</code></pre>
<p>【补充：LRU算法】</p>
<p>​    LRU(Least Recently Used)，即最近最少使用，是一种缓存置换算法。在使用内存作为缓存的时候，缓存的大小一般是固定的。当缓存被占满，这个时候继续往缓存里面添加数据，就需要淘汰一部分老的数据，释放内存空间用来存储新的数据。这个时候就可以使用LRU算法了。其核心思想是：如果一个数据在最近一段时间没有被用到，那么将来被使用到的可能性也很小，所以就可以被淘汰掉。</p>
<p>​     Redis 中的 LRU 不是严格意义上的LRU算法实现，是一种近似的 LRU 实现，主要是为了节约内存占用以及提升性能。Redis 配置文件有这样一个配置 —— <code>maxmemory-samples</code>，Redis 的 LRU 是取出配置的数目(默认的是5)的key，然后从中选择一个最近最久未使用的 key 进行置换。可以通过调整样本数量来取得 LRU 置换算法的速度或是精确性方面的优势。Redis 不采用真正的 LRU 实现的原因是为了节约内存使用</p>
<h3 id="Redis介绍相关知识"><a href="#Redis介绍相关知识" class="headerlink" title="Redis介绍相关知识"></a>Redis介绍相关知识</h3><p>端口 6379 的由来，它是根据 Merz  这个名字来的，九键输入法的  M  e  r  z  四个字母对应着  6  3  7  9 四个数字</p>
<ul>
<li>Redis默认有16个数据库 0 - 15，默认是 0 号库</li>
<li>使用  select  &lt;库的编号&gt;   来切换库</li>
<li>统一密码管理，所有库有着同样的密码</li>
</ul>
<p>==<strong>Redis是单线程 + 多路 IO 复用技术</strong>==</p>
<p>​       多路复用是指使用一个线程来检查多个文件描述符( Socket )的就绪状态,比如调用select和poll函数,传入多个文件描述符,如果有一个文件描述符就绪,则返回,否则阻塞直到超时。得到就绪状态后进行真正的操作可以在同一个线程里执行,也可以启动新的线程执行(比如使用线程池)。也就是<strong>单个线程，跟踪、管理多个I/O流 。</strong></p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210801005200.png"></p>
<p>在黄牛买到票之前， 1,2,3号他们还是干自己的事情，这就是多路 IO 复用，提高CPU利用率</p>
<p>Redis与Memcache的三点不同：支持多数据类型，支持持久化，单线程 + 多路 IO 复用</p>
<h4 id="Redis-key键操作"><a href="#Redis-key键操作" class="headerlink" title="Redis key键操作"></a>Redis key键操作</h4><ul>
<li><p>keys *  </p>
<ul>
<li>查看当前所有库</li>
</ul>
</li>
<li><p>exists  key</p>
<ul>
<li>判断某个key是否存在</li>
</ul>
</li>
<li><p>type key</p>
<ul>
<li>查看你的key对应的value是什么类型</li>
</ul>
</li>
<li><p>del key</p>
<ul>
<li>删除指定的key数据</li>
</ul>
</li>
<li><p>unlink  key</p>
<ul>
<li><strong>根据value选择非阻塞删除</strong>，也就是仅将key从keyspace元数据中删除，<strong>真正的删除会在后续异步操作</strong></li>
</ul>
</li>
<li><p>expire key  时间</p>
<ul>
<li>为给定的key设置过期时间，单位为秒，若是没有设置过期时间，则默认永不过期</li>
</ul>
</li>
<li><p>ttl  key</p>
<ul>
<li>查看还有多少秒过期，-1表示永不过期，-2表示已经过期</li>
</ul>
</li>
<li><p>select  库编号</p>
<ul>
<li>切换数据库</li>
</ul>
</li>
<li><p>dbsize </p>
<ul>
<li>查看当前数据库的key的数量</li>
</ul>
</li>
<li><p>flushdb 和  flushall</p>
<ul>
<li>清空当前库</li>
</ul>
</li>
</ul>
<h3 id="Redis常用数据类型"><a href="#Redis常用数据类型" class="headerlink" title="Redis常用数据类型"></a>Redis常用数据类型</h3><p>==<strong>常用数据类型都是针对于key - value 的value来说的</strong>==，这个value可以是string，list，set，hash。。。</p>
<h4 id="Redis字符串-String"><a href="#Redis字符串-String" class="headerlink" title="Redis字符串(String)"></a>Redis字符串(String)</h4><ul>
<li>简介<ul>
<li>String是Redis最基本的类型,你可以理解成与Memcached 一模一样的类型， 一个key对应一个value。</li>
<li>String类型是<strong>二进制安全的</strong>。 意味着Redis的string可以包含任何数据。比如jpg图片或者序列化的对象。只要能变成字符串就都能存到String里面去。</li>
<li><strong>String类型是Redis最基本的数据类型,</strong> 一个Redis中字符串value 最多可以是<strong>512M</strong>。</li>
</ul>
</li>
</ul>
<ul>
<li>常用命令<ul>
<li>set  &lt;key&gt;  &lt;value&gt;<ul>
<li> 添加键值对。如果key不为空，则达到一个覆盖的效果</li>
</ul>
</li>
<li>get  &lt;key&gt;   <ul>
<li>查询对应键的值</li>
</ul>
</li>
<li>getset  &lt;key&gt;  &lt;value&gt;   <ul>
<li> 以旧换新，设置新值的同时返回旧值</li>
</ul>
</li>
<li>append   &lt;key&gt;  &lt;value&gt;  <ul>
<li>将给定的 &lt;valule&gt; 追加到原值的末尾</li>
</ul>
</li>
<li>strlen  &lt;key&gt; <ul>
<li>获得值的长度</li>
</ul>
</li>
<li>setnx   &lt;key&gt;  &lt;value&gt;  <ul>
<li>只有key不存在时才能设置key的值</li>
</ul>
</li>
<li>setex  &lt;key&gt; 过期时间  &lt;value&gt;    <ul>
<li>添加数据的时候就设置过期时间，expire 是为已存在的key设置过期时间，注意区别</li>
</ul>
</li>
<li>incr  &lt;key&gt; <ul>
<li>将key中存储的数字值增1，<strong>只能对数字值操作</strong>，如果key为空，则新增值为1</li>
</ul>
</li>
<li>decr  &lt;key&gt; <ul>
<li>将key中存储的数字值减1</li>
</ul>
</li>
<li>incrby\decrby  &lt;key&gt; &lt;步长&gt; <ul>
<li> 将key中存储的数字值根据自定义步长增减</li>
</ul>
</li>
<li>mset  &lt;key1&gt;  &lt;value1&gt;  &lt;key2&gt;  &lt;value2&gt;  …   &lt;key n&gt;&lt;value n&gt;  <ul>
<li>添加多个值</li>
</ul>
</li>
<li>mget  &lt;key1&gt; &lt;key2&gt; …   &lt;key n&gt; <ul>
<li>查看多个值</li>
</ul>
</li>
<li>msetnx    &lt;key1&gt;  &lt;value1&gt;  &lt;key2&gt;  &lt;value2&gt;  …   &lt;key n&gt;&lt;value n&gt;    <ul>
<li>当且仅当添加的key都不存在时才成功</li>
</ul>
</li>
<li>getrange &lt;key&gt; &lt;起始位置&gt; &lt;结束位置&gt;      <ul>
<li>截取范围  [起始位置，结束位置]  内的值。开始索引为0</li>
</ul>
</li>
<li>setrange  &lt;key&gt; &lt;起始位置&gt; &lt;value&gt;   <ul>
<li>从起始位置开始(开始索引为0)，用 &lt;value&gt;覆盖原来的值， &lt;value&gt;有几位就覆盖几位，覆盖不了的还是显示旧 &lt;value&gt;的值</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Redis单命令是原子性的</p>
<ul>
<li>原子操作是指不会被线程调度机制打断的操作，这种操作一旦开始，就一直运行到结束，中间不会有任何context switch</li>
<li><strong>在单线程中，能够在单条指令中完成的操作都可以认为是“原子操作”，因为中断只发生在指令之间</strong></li>
<li>在多线程中，不能被其他进程或线程打断的操作就叫原子操作</li>
<li>==<strong>Redis单命令的原子性主要得益于Redis是单线程的</strong>==</li>
</ul>
<p>【补充问题：】</p>
<p>java中的 i++ 是否是原子操作？ 答案：不是</p>
<p>i = 0； 两个线程分别对i进行 ++100次，值是多少？   答案 ： 2 ~ 200 之间都有可能</p>
<p>分析：</p>
<table>
<thead>
<tr>
<th>a线程</th>
<th>b线程</th>
</tr>
</thead>
<tbody><tr>
<td>i = 0</td>
<td>i = 0</td>
</tr>
<tr>
<td>i++</td>
<td>被a打断</td>
</tr>
<tr>
<td>…  到 i=99</td>
<td>被a打断</td>
</tr>
<tr>
<td>被b打断</td>
<td>i++</td>
</tr>
<tr>
<td>被b打断</td>
<td>i = 1</td>
</tr>
<tr>
<td>i = 1</td>
<td>被a打断</td>
</tr>
<tr>
<td>被b打断</td>
<td>i ++</td>
</tr>
<tr>
<td>被b打断</td>
<td>直到   i = 100</td>
</tr>
<tr>
<td>i ++</td>
<td>b结束</td>
</tr>
<tr>
<td>i = 2</td>
<td>b结束</td>
</tr>
</tbody></table>
<p>底层数据结构</p>
<p>​     String的数据结构为<strong>简单动态字符串</strong>，是可以修改的字符串，内部结构实现上类似于java的ArrayList，采用预分配冗余空间的方式来减少内存频繁分配，内部为当前字符串时间分配的空间一般要高于实际字符串长度len。当字符串长度小于 1M 时，扩容都是加倍现有的空间，如果超过 1M ，扩容时一次只会增加 1M 的空间，需要注意的是<strong>字符串最大长度为 512M</strong>。</p>
<h4 id="Redis列表-List"><a href="#Redis列表-List" class="headerlink" title="Redis列表(List)"></a>Redis列表(List)</h4><p>简介：</p>
<p>​    Redis列表是简单的字符串列表，按照插入顺序排序，可以添加一个元素到列表的头部（左边）或者尾部（右边），它的底层实际上是==<strong>双向列表</strong>==，对两端的操作性能很高，通过索引下标操作中间的结点性能会较差</p>
<p>常用命令</p>
<ul>
<li><p>lpush/rpush   &lt;key1&gt;  &lt;value1&gt;  &lt;value2&gt;  …  &lt;value n&gt;  </p>
<ul>
<li>从左边/右边插入一个或多个值</li>
<li>lpush 是从最左边放值，一个挤一个的放，把第一个挤到最后一个</li>
<li>rpush 是从最右边放值，一个挤一个的放，把最后一个挤到第一个</li>
</ul>
</li>
<li><p>lpop/rpop   &lt;key1&gt;  [count]</p>
<ul>
<li>从左边/右边吐出count个值，==<strong>值有键在，值无键亡</strong>==</li>
</ul>
</li>
<li><p>rpoplpush  &lt;key1&gt;  &lt;key2&gt;</p>
<ul>
<li>从&lt;key1&gt; 列表右边吐出一个值，插入到 &lt;key2&gt; 列表左边，没有   lpoprpush   这条指令</li>
</ul>
</li>
<li><p>lrange &lt;key1&gt;  &lt;start&gt;  &lt;stop&gt; </p>
<ul>
<li>按照索引下标获取元素（从左到右） </li>
<li>lrange key 0  -1 : 表示获取key的所有值</li>
</ul>
</li>
<li><p>lindex  &lt;key&gt; &lt;index&gt; </p>
<ul>
<li>按照索引下标（从0开始）获得元素（从左到右）</li>
</ul>
</li>
<li><p>llen  &lt;key&gt;  </p>
<ul>
<li>获取列表长度</li>
</ul>
</li>
<li><p>linsert &lt;key&gt; before/after  &lt;value&gt;  &lt;newvalue&gt;</p>
<ul>
<li>在 &lt;value&gt;的前面/后面插入  &lt;newvalue&gt; </li>
</ul>
</li>
<li><p>lrem  &lt;key&gt;  &lt;n&gt;  &lt;value&gt; </p>
<ul>
<li>从左边删除n个value（从左到右）</li>
</ul>
</li>
<li><p>lset  &lt;key&gt;  &lt;index&gt;  &lt;value&gt; </p>
<ul>
<li>将列表key下标为index(从0开始)的值替换成value</li>
</ul>
</li>
</ul>
<p>底层数据结构</p>
<p>​    List的数据结构为快速链表quickList。首先在列元素较少的情况下会使用一块连续的空间,这个结构是ziplist ,也即是<br>压缩列表。它将所有的元素紧挨着一起存储,分配的是一块连续的内存。当数据量比较多的时候才会改成quicklist。</p>
<p>​    因为普通的链表需要的附加指针空间太大,比较浪费空间。比如这个列表里存的只是int类型的数据结构，它还需要两个额外的指针prev和next.。</p>
<p>​    Redis将链表和ziplist结合起来组成了quicklist.也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能,又不会出现太大的空间冗余。</p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210801091812.png"></p>
<h4 id="Redis集合（set）"><a href="#Redis集合（set）" class="headerlink" title="Redis集合（set）"></a>Redis集合（set）</h4><p>简介<br>    Redis set对外提供的功能与list类似也是一个列表的功能 ,特殊之处在于set是可以<strong>自动排重</strong>，当你需要存储一个列表数据，又不希望出现重复数据时, set是一个很好的选择，并且set提供了判断某个成员否在一个set集合内的重要接口,这个也是list所不能提供的。</p>
<p>​    Redis的Set是string类型的无序集合。它<strong>底层是一个value为null的hash表</strong>，所以添加,删除,查找的复杂度都是**0(1)**。集合中数据增加，查找数据的时间还是不变。</p>
<p>常用命令</p>
<ul>
<li><p>sadd  &lt;key&gt;   &lt;value1&gt;  &lt;value2&gt; ….</p>
<ul>
<li>将一个或多个值添加到集合key中，已经存在的值是添加不进去的</li>
</ul>
</li>
<li><p>smembers   &lt;key&gt; </p>
<ul>
<li>取出该集合的所有值</li>
</ul>
</li>
<li><p>sismember  &lt;key&gt;  &lt;value&gt;</p>
<ul>
<li>判断集合&lt;key&gt;是否为含有该&lt;value&gt; 的值，有返回1，没有返回0</li>
</ul>
</li>
<li><p>scard  &lt;key&gt;</p>
<ul>
<li>返回该集合的元素个数</li>
</ul>
</li>
<li><p>srem &lt;key&gt; &lt;value1&gt; &lt;value2&gt;…</p>
<ul>
<li> 删除集合中的元素</li>
</ul>
</li>
<li><p>spop &lt;key&gt; </p>
<ul>
<li>随机从该集合中吐出一个值，意味着<strong>该元素从集合中删除</strong></li>
</ul>
</li>
<li><p>srandmember &lt;key&gt; &lt;n&gt;</p>
<ul>
<li>随机从该集合中取出n个值，<strong>不会从集合中删除</strong></li>
</ul>
</li>
<li><p>smove &lt;source&gt;  &lt;destination&gt; value</p>
<ul>
<li>把集合中的一个值从一个集合移动到另一个集合</li>
</ul>
</li>
<li><p>sinter &lt;key1&gt; &lt;key2&gt;</p>
<ul>
<li>返回两个集合的交集元素</li>
</ul>
</li>
<li><p>sunion  &lt;key1&gt;  &lt;key2&gt;</p>
<ul>
<li>返回两个集合的并集元素</li>
</ul>
</li>
<li><p>sdiff &lt;key1&gt; &lt;key2&gt;</p>
<ul>
<li>返回key1集合中的，key2集合中没有的差集元素</li>
</ul>
</li>
</ul>
<p>底层数据结构</p>
<p>​        Java中HashSet的内部实现使用的是HashMap ,只不过所有的value都指向同一个对象。</p>
<p>​       Redis的set结构也是一样,它的内部也使用hash结构。</p>
<h4 id="Redis哈希（hash）"><a href="#Redis哈希（hash）" class="headerlink" title="Redis哈希（hash）"></a>Redis哈希（hash）</h4><p> 简介：</p>
<p>Redis hash是一个键值对集合。 Redis hash是一个 string类型的field 和value的映射表, hash特别适合于存储对象。类似Java里面的Map&lt;String,Object&gt;。用户ID为查找的key，存储的value户对象包含姓名,年龄，生日等信息,</p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210801103427.png"></p>
<p>常用指令</p>
<ul>
<li><p>hset &lt;key&gt;  &lt;field&gt;   &lt;value&gt; </p>
<ul>
<li>给集合中的   赋值 &lt;value&gt; 到 &lt;filed&gt;键</li>
</ul>
</li>
<li><p>hget  &lt;key1&gt;  &lt;filed&gt; </p>
<ul>
<li>取出 &lt;key1&gt;集合 &lt;filed&gt;的值</li>
</ul>
</li>
<li><p>hmset  &lt;key1&gt;   &lt;filed1&gt; &lt;value1&gt;   &lt;field2&gt; &lt;value2&gt;</p>
<ul>
<li>批量设置hash值</li>
</ul>
</li>
<li><p>hexists   &lt;key1&gt;   &lt;field&gt;</p>
<ul>
<li>查看hash表key中给定域field是否存在，返回1表示存在，返回0表示没有</li>
</ul>
</li>
<li><p>hkeys   &lt;key&gt;</p>
<ul>
<li>列出该hash集合的所有field</li>
</ul>
</li>
<li><p>hvals   &lt;key&gt;</p>
<ul>
<li>列出该hash集合的所有value</li>
</ul>
</li>
<li><p>hincrby   &lt;key&gt;  &lt;field&gt; &lt;increment&gt; </p>
<ul>
<li>为哈希表 key 中的  filed  的值加上一个增量 increment</li>
</ul>
</li>
<li><p>hsetnx   &lt;key&gt;  &lt;field&gt; &lt;value&gt; </p>
<ul>
<li>为哈希表 key 中的  filed  的值加上一个增量 increment，<strong>当且仅当 field 不存在</strong></li>
</ul>
</li>
</ul>
<p>底层数据结构</p>
<p>​    Hash类型对应的数据结构是两种: ziplist (压缩列表)，hashtable (哈希表)。当field-value长度较短且个数较少时，使用ziplist,否则使用hashtable.。</p>
<p>【回忆】：HashTable和HashMap区别</p>
<ul>
<li><p>继承：</p>
<ul>
<li>HashTable继承自Dirctionary，HashMap继承自AbstractMap，二者均实现了Map接口；</li>
</ul>
</li>
<li><p>线程安全性：</p>
<ul>
<li>HashTable的方法是同步的，即是线程安全的。HaspMap的方法不是同步的，不是线程安全的。在多线程并的情况下，我们可以直接使用HashTable，如果 要使用HashMap，就需要自行对HashMap的同步处理。</li>
</ul>
</li>
<li><p>键值：</p>
<ul>
<li>HashTable中不允许有null键和null值，HashMap中允许出现一个null键，可以存在一个或者多个键的值都为null。程序中，对于HashMap，如果使用get(参数为 键)方法时，返回结果为null，可能是该键不存在，也可能是该键对应的值为null，这就出现了结果的二义性。因此，在HashMap中，我们不能使用get()方法来查询键 对应的值，应该使用containskey()方法。</li>
</ul>
</li>
<li><p>哈希值：</p>
<ul>
<li>HashTable是直接使用对象的hashCode。HashMap是重新计算hash值。</li>
</ul>
</li>
<li><p>扩容：</p>
<ul>
<li>HashTable和HashMap的底层实现的数组和初始大小和扩容方式。HashTable初始大小为11，并且每次扩容都为：2 * old+1。HashMap的默认大小为16，并且一 定是2的指数，每次扩容都为old * 2。</li>
</ul>
</li>
</ul>
<h4 id="Redis有序集合Zset（sorted-set）"><a href="#Redis有序集合Zset（sorted-set）" class="headerlink" title="Redis有序集合Zset（sorted set）"></a>Redis有序集合Zset（sorted set）</h4><p>简介：</p>
<p>​        Redis有序集合Zset 与普通集合set非常相似，是一个<strong>没有重复元素</strong>的字符串集合。</p>
<p>​        不同之处是有序集合的每个成员都关联了一个评分( score) ，这个评分( score )被用来按照从最低分到最高分的方式排集合中的成员。</p>
<p>​        集合的成员是唯一的，但是评分可以是重复的。因为元素是有序的，所以也可以很快的根据评分( score )或者次序( position )来获取一个范围的元素。</p>
<p>​        访问有序集合的中间元素也是非常快的，因此你能够使用有序集合作为一个没有重复成员的智能列表。</p>
<p>常用命令</p>
<ul>
<li><p>zadd &lt;key&gt; &lt;socre1&gt; &lt;value1&gt; &lt;score2&gt; &lt;value2&gt; …</p>
<ul>
<li>将一个或多个 member 元素及其score 值加入到有序集 key当中</li>
</ul>
</li>
<li><p>zrange &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSOCRES]</p>
<ul>
<li>返回有序集key中，下标在 &lt;start&gt;  &lt;stop&gt; 之间的元素，带WITHSOCRES，可以让分数一起和值返回到结果集</li>
<li>start 为 0 和 stop  为 -1  时，表示可以取出集合中的所有值</li>
</ul>
</li>
<li><p>zrangebyscore key min  max [withsocres] </p>
<ul>
<li>返回有序集key中，所有score值介于并包括 min 和 max之间的成员，有序集成员按score值从小到大排序</li>
</ul>
</li>
<li><p>zrevrangebyscore key  max  min  [withsocres] </p>
<ul>
<li>同上，改为从大到小</li>
</ul>
</li>
<li><p>zcount  &lt;key&gt;  &lt;min&gt;  &lt;max&gt; </p>
<ul>
<li>统计该集合分数区间内的元素个数</li>
</ul>
</li>
<li><p>zincrby &lt;key&gt;  &lt;increment&gt;  &lt;value&gt; </p>
<ul>
<li>为元素的score加上增量</li>
</ul>
</li>
<li><p>zrem  &lt;key&gt;  &lt;value&gt; </p>
<ul>
<li>删除该集合下指定值的元素</li>
</ul>
</li>
<li><p>zrank  &lt;key&gt;  &lt;value&gt; </p>
<ul>
<li>返回该值在集合中的排名，从0开始</li>
</ul>
</li>
</ul>
<p>底层数据结构</p>
<p>​        SortedSet (zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构Map&lt;String, Double&gt; ，可以给每一个元素 value赋予一个权重score ，另一方面它又类似于TreeSet ，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。<br>​    </p>
<p>​    zset底层使用了两个数据结构。</p>
<ul>
<li>hash <ul>
<li>hash的作用就是关联元素value和权重score，保障元素value的唯一性,可以通过元素value找到相应的score值。</li>
</ul>
</li>
<li>跳跃表<ul>
<li>跳跃表的目的在于给元素value排序和根据score的范围获取元素列表。<strong>文章最后有解释跳跃表</strong></li>
</ul>
</li>
</ul>
<h3 id="Redis的发布和订阅"><a href="#Redis的发布和订阅" class="headerlink" title="Redis的发布和订阅"></a>Redis的发布和订阅</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>Redis发布订阅（pub/sub）是一种消息通信模式：发送者（publish）发送消息，订阅者（subscribe）接收消息。</p>
<p>Redis客户端可以订阅任意数量的频道。</p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210801141145.png"></p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210801141206.png"></p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210801141509.png"></p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210801141443.png"></p>
<h3 id="Redis新增数据类型"><a href="#Redis新增数据类型" class="headerlink" title="Redis新增数据类型"></a>Redis新增数据类型</h3><h4 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h4><p>简介：</p>
<p>现代计算机用二进制(位)作为信息的基础单位，1 个字等于8位，例如”abc”字符串是由3个字节组成，但实际在计算机存储时将其用二进制表示，”abc” 分别对应的ASCII码分别是97、98、 99， 对应的二进制分别是01100001、01100010和01100011。</p>
<p>合理地使用操作位能够有效地提高内存使用率和开发效率。Redis提供了Bitmaps这个“数据类型”可以实现对位的操作: 。<br>(1) Bitmaps本身不是一 种数据类型，实际上它就是字符串( key-value ),但是它可以对字符串的位进行操作。<br>(2) Bitmaps单独提供了一套命令，所以在Redis中使用Bitmaps和使用字符串的方法不太相同。可以把 Bitmaps 想象成一个以位为单位的数组,数组的每个单元只能存储0和1，数组的下标在Bitmaps中叫做偏移量。</p>
<p>常用命令：</p>
<ul>
<li><p>setbit &lt;key&gt; &lt;offest&gt; &lt;value&gt;</p>
<ul>
<li>设置Bitmaps中某个偏移量的值（0或1），offest的偏移量从0开始</li>
</ul>
</li>
<li><p>在第一次初始化Bitmaps时， 假如偏移量非常大， 那么整个初始化过程执行会比较慢， 可能会造成Redis的阻塞。</p>
</li>
<li><p>getbit &lt;key&gt; &lt;offest&gt;</p>
<ul>
<li>获取Bitmaps中某个偏移量的值</li>
</ul>
</li>
<li><p>bitcount </p>
<ul>
<li>统计字符串被设置为1的bit数。一般情况下，给定的整个字符串都会被进行计数，通过指定额外的start或end参数，可以让计数只在特定的位上进行。start 和end参数的设置，可以是负数值:如-1表示最后一个位，而-2表示倒数第个二位，start、end 是指<strong>bit组（代表8个bit）</strong>的字节的下标数，二者皆包含。</li>
<li>bitcount  &lt;key&gt; [start end]<ul>
<li>统计字符串从start字节(从0开始)到end字节的比特值为1的数量，<strong>注意是字节</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>bitop and/or/not/xor &lt;destkey&gt; [key…]</p>
<ul>
<li>bitop是一个复合操作，它可以做多个Bitmaps的and、or、not、xor操作并将结果保存在destkey中</li>
</ul>
</li>
</ul>
<h4 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h4><p>简介：</p>
<p>​    在工作当中，我们经常会遇到与统计相关的功能需求，比如统计网站PV(PageView页面访问量) ，可以使用Redis的incr、incrby 轻松实现。</p>
<p>​    但像UV ( UniqueVisitor ,独位访客)、独立IP数、搜索记录数等要去重和计数的问题如何解决？这种求集合中不重复元素个数的问题称为基数问题。解决基数问题有很多种方案:</p>
<p>(1 )数据存储在MySQL中,使用distinct count计算不重复个数。</p>
<p>( 2)使佣Redis提供的hash、 set、bitmaps等数据结构来处理</p>
<p>   以上的方案结果精确，但随着数据不断增加，导致占用空间越来越大，对于非常大的数据集是不切实际的。</p>
<p>   能否能够降低一定的精度平衡存储空间？ Redis推出了HyperLogLog</p>
<p>   Redis HyperLogLog 用来做基数统计的算法，HyperLogLog的优点是,在输入元素的数量或者体积非常非常大时,计算基数所需的空间总是固定的、組是很小的。</p>
<p>   在Redis里面，每个HyperLogLog键只需要花费12 KB内存，就可以计算接近2^64个不同元素的基数。这和计算基数时，元素越多 耗费内存就越多的集合形成鲜明对比。</p>
<p>​    但是,因为HyperLogLog只会根据输入元素来计算基数,而不会储存输入元素本身,所以HyperLogLog不能像集合那样,返回输入的各个元素。</p>
<p>   什么是基数?。<br>    比如数据集{1, 3,5,7,5, 7, 8},那么这个数据集的基数集为{1, 3,5 ,7, 8},基数(不重复元素)为5个。基数估计就是在误差可接受的范围内 ,快速计算基数。</p>
<p>常用命令</p>
<ul>
<li><p>pfadd &lt;key&gt;  &lt;element&gt; [element…] </p>
<ul>
<li>添加指定元素到 HyperLogLog中，添加成功返回1，否则为0</li>
</ul>
</li>
<li><p>pfcount  &lt;key&gt;</p>
<ul>
<li>统计基数个数</li>
</ul>
</li>
<li><p>pfmerge  &lt;destkey&gt;   &lt;sourcekey&gt;   &lt;sourcekey&gt;  …</p>
<ul>
<li>将一个或多个 sourcekey 合并计算并存储在 destkey 中</li>
</ul>
</li>
</ul>
<h4 id="Geospatial"><a href="#Geospatial" class="headerlink" title="Geospatial"></a>Geospatial</h4><p>简介</p>
<p>​    Redis 3.2 中增加了对GEO型的支持。GEO , Geographic ,地理信息的缩写。该类型就是元素的2维坐标，在地图上就是经纬度，redis 基于该类型，提供了经纬度设置，查询，范围查询，距离查询，经纬度Hash等常见操作。</p>
<p>常用命令</p>
<ul>
<li><p>geoadd &lt;key&gt; &lt;longitude&gt;  &lt;latitude&gt;  &lt;member&gt;</p>
<ul>
<li>添加地理位置（经度，纬度，名称），可以添加多个</li>
</ul>
</li>
<li><p>geopos  &lt;key&gt;  &lt;member&gt;  </p>
<ul>
<li>获取指定地区的坐标值</li>
</ul>
</li>
<li><p>geodist   &lt;key&gt;   &lt;member1&gt;   &lt;member2&gt;   [m|km|ft|mi] </p>
<ul>
<li>获取两个位置之间的直线距离，单位默认是  m </li>
</ul>
</li>
<li><p>georadius  &lt;key&gt;   &lt;longitude&gt;  &lt;latitude&gt; radius    [m|km|ft|mi] </p>
<ul>
<li>以给定的半径找出此半径内的元素</li>
</ul>
</li>
</ul>
<h3 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h3><p>导入依赖</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//redis的所有命令都在jedis中有对应的方法，这里只显示了一部分</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisDemo1</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//创建Jedis对象</span>
        Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.130.172"</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//测试连接</span>
<span class="token comment" spellcheck="true">//        String ping = jedis.ping();</span>
<span class="token comment" spellcheck="true">//        System.out.println(ping);</span>

        <span class="token comment" spellcheck="true">//添加</span>
        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Tom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//获取</span>
        String s <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//设置多个key - value</span>
        jedis<span class="token punctuation">.</span><span class="token function">mset</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span><span class="token string">"v1"</span><span class="token punctuation">,</span><span class="token string">"k2"</span><span class="token punctuation">,</span><span class="token string">"v2"</span><span class="token punctuation">,</span><span class="token string">"k3"</span><span class="token punctuation">,</span><span class="token string">"v3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        List<span class="token operator">&lt;</span>String<span class="token operator">></span> mget <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mget<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Set<span class="token operator">&lt;</span>String<span class="token operator">></span> keys <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>String key <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>【注意：】</p>
<ul>
<li>查看配置文件 /etc/redis.conf <ul>
<li>注掉 bind = 127.0.0.1</li>
<li>把protected-mode yes  改为  protected-mode no</li>
</ul>
</li>
<li>关闭firewalld 和 iptables<ul>
<li>systemctl stop  firewalld </li>
<li>service iptables stop</li>
</ul>
</li>
</ul>
<h4 id="案例：模拟验证码发送"><a href="#案例：模拟验证码发送" class="headerlink" title="案例：模拟验证码发送"></a>案例：模拟验证码发送</h4><ul>
<li>输入手机号，点击发送后随机生成6位数字码，2分钟有效</li>
<li>输入验证码，点击验证，返回成功或失败</li>
<li>每个手机号每天只能输入3次</li>
</ul>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210801185150.png"></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author 王瀚文
 * @Description:
 * @date 2021-08-01 18:53
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneCode</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 连接redis
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.130.172"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token function">verifyCode</span><span class="token punctuation">(</span><span class="token string">"15110636286"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">getRedisCode</span><span class="token punctuation">(</span><span class="token string">"15110636286"</span><span class="token punctuation">,</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"VerifyCode15110636286:code"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


    <span class="token comment" spellcheck="true">/**
     * 1.生成六位随机数
     *
     * @return 六位随机数
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        StringBuilder sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> rand <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 2.每个手机每天只能发送三次，验证码放到redis中，设置过期时间
     *
     * @param phone 手机号
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">verifyCode</span><span class="token punctuation">(</span>String phone<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//拼接手机发送次数的key</span>
        String countKey <span class="token operator">=</span> <span class="token string">"VerifyCode"</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">":count"</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//拼接验证码的key</span>
        String codeKey <span class="token operator">=</span> <span class="token string">"VerifyCode"</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">":code"</span><span class="token punctuation">;</span>


        String s <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>countKey<span class="token punctuation">,</span> <span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span>countKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"今天发送次数超过三次"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

        String code <span class="token operator">=</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 3.验证码校验
     *
     * @param phone 手机号
     * @param code  验证码
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getRedisCode</span><span class="token punctuation">(</span>String phone<span class="token punctuation">,</span> String code<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//拼接验证码的key</span>
        String codeKey <span class="token operator">=</span> <span class="token string">"VerifyCode"</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">":code"</span><span class="token punctuation">;</span>

        String redisCode <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>codeKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>redisCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="springboot整合redis"><a href="#springboot整合redis" class="headerlink" title="springboot整合redis"></a>springboot整合redis</h3><ul>
<li>导入依赖</li>
</ul>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.11.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre>
<ul>
<li>配置文件</li>
</ul>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">#Redis服务器地址</span>
<span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">192.168.130.172</span>
<span class="token comment" spellcheck="true">#Redis服务器连接端D</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span>
<span class="token comment" spellcheck="true">#Redis数据库索引(默认为0)</span>
<span class="token attr-name">spring.redis.database</span><span class="token punctuation">=</span><span class="token attr-value">0</span>
<span class="token comment" spellcheck="true">#连接超时时间(毫秒)</span>
<span class="token attr-name">spring.redis.timeout</span><span class="token punctuation">=</span><span class="token attr-value">1800000s</span>
<span class="token comment" spellcheck="true">#连接池最大连接数(使用负值表示没有限制)</span>
<span class="token attr-name">spring.redis.lettuce.pool.max--active</span><span class="token punctuation">=</span><span class="token attr-value">20</span>
<span class="token comment" spellcheck="true">#最大阻塞等待时间(负数表示没限制)</span>
<span class="token attr-name">spring.redis.lettuce.pool.maxwait</span><span class="token punctuation">=</span><span class="token attr-value">-1s</span>
<span class="token comment" spellcheck="true">#连接池中的最大空闲连接</span>
<span class="token attr-name">spring.redis.lettuce.pool.max-idle</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
<span class="token comment" spellcheck="true">#连接池中的最小空闲连接</span>
<span class="token attr-name">spring.redis.lettuce.pool.min-idle</span><span class="token punctuation">=</span><span class="token attr-value">0</span>
</code></pre>
<ul>
<li>配置类</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * @author 王瀚文
 * @Description:
 * @date 2021-08-01 22:09
 */</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Bean</span>
   <span class="token keyword">public</span> RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory factory<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      RedisSerializer<span class="token operator">&lt;</span>String<span class="token operator">></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ObjectMapper om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>PropertyAccessor<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> JsonAutoDetect<span class="token punctuation">.</span>Visibility<span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span>ObjectMapper<span class="token punctuation">.</span>DefaultTyping<span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
      jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
      template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
      template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> template<span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Bean</span>
   <span class="token keyword">public</span> CacheManager <span class="token function">cacheManager</span><span class="token punctuation">(</span>RedisConnectionFactory factory<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      RedisSerializer<span class="token operator">&lt;</span>String<span class="token operator">></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ObjectMapper om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>PropertyAccessor<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span>JsonAutoDetect<span class="token punctuation">.</span>Visibility<span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span>ObjectMapper<span class="token punctuation">.</span>DefaultTyping<span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
      jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
      RedisCacheConfiguration config <span class="token operator">=</span> RedisCacheConfiguration<span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span>RedisSerializationContext<span class="token punctuation">.</span>SerializationPair<span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span>RedisSerializationContext<span class="token punctuation">.</span>SerializationPair<span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      RedisCacheManager cacheManager <span class="token operator">=</span> RedisCacheManager<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cacheManager<span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<ul>
<li>controller层</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/redisTest"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisTestController</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Autowired</span>
   <span class="token keyword">private</span> RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> redisTemplate<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@GetMapping</span>
   <span class="token keyword">public</span> String <span class="token function">testRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//设置值到redis</span>
      redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"Tom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">//从redis获取值</span>
      String name <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> name<span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><h4 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h4><p>​    Redis事务是一个单独的隔离操作，事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请所打断。</p>
<p>​    Redis事务的==<strong>主要作用就是串联多个命令防止别的命令插队</strong>==。</p>
<p>【回忆MySQL事务：一个或一组sql语句组成的执行单元】</p>
<h4 id="Multi-–-Exec-–-discard"><a href="#Multi-–-Exec-–-discard" class="headerlink" title="Multi  –  Exec  –  discard"></a>Multi  –  Exec  –  discard</h4><p>从输入Multi 命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。组队的过程中可以通过discard来放弃组队。</p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210802072030.png"></p>
<h4 id="事务错误处理"><a href="#事务错误处理" class="headerlink" title="事务错误处理"></a>事务错误处理</h4><ul>
<li>组队中某个命令出现了报告错误，执行时整个队列都会被取消</li>
</ul>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210802072642.png"></p>
<ul>
<li>执行阶段某个命令报出了错误，则只有报错的命令不会被执行，其他的命令都会执行，<strong>不会回滚</strong>。</li>
</ul>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20210802072808.png"></p>
<h4 id="事务冲突-悲观锁，乐观锁"><a href="#事务冲突-悲观锁，乐观锁" class="headerlink" title="事务冲突(悲观锁，乐观锁)"></a>事务冲突(悲观锁，乐观锁)</h4><p>悲观锁</p>
<p>​    悲观锁(Pessimistic Lock)，顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block 直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁，读锁，写锁等，都是在做操作之前先上锁。</p>
<p>乐观锁</p>
<p>​    乐观锁(Optimistic Lock),，顾名思义，就是很乐观 ，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号或者时间戳等机制。<strong>乐观锁适用于多读的应用类型，这样可以提高吞吐量</strong>。Redis 就是利用这种  check-and-set(CAS)  机制实现事务的。</p>
<p>【CAS是项乐观锁技术，当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试。</p>
<p> CAS 操作包含三个操作数 —— 内存位置（V）、预期原值（A）和新值(B)。如果内存位置的值与预期原值相匹配，那么处理器会自动将该位置值更新为新值。否则，处理器不做任何操作。无论哪种情况，它都会在 CAS 指令之前返回该位置的值。（在 CAS 的一些特殊情况下将仅返回 CAS 是否成功，而不提取当前值。）CAS 有效地说明了“我认为位置 V 应该包含值 A；如果包含该值，则将 B 放到这个位置；否则，不要更改该位置，只告诉我这个位置现在的值即可。”这其实和乐观锁的冲突检查+数据更新的原理是一样的。==<strong>乐观锁是一种思想。CAS是这种思想的一种实现方式</strong>==。】</p>
<ul>
<li><p>WATCH key [key…]</p>
<ul>
<li>在执行multi之前，先执行watch key1 [key2]，可以监视一个(或多个) key ， 如果在事务执行之前这个(或这些) key被其他命令所改动,那么事务将被打断。</li>
</ul>
</li>
<li><p>unwatch</p>
<ul>
<li>取消对所有key的监视</li>
</ul>
</li>
</ul>
<h4 id="Redis事务三特性"><a href="#Redis事务三特性" class="headerlink" title="Redis事务三特性"></a>Redis事务三特性</h4><ul>
<li>单独的隔离操作<br>  事务中的所有命令 都会序列化、按顺序地执行。事务在执行的过程中, 不会被其他客户端发送来的命令求所打断。</li>
<li>没有隔离级别的概念 。<br>  队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行。</li>
<li>不保证原子性<br>事务中如果有一 条命令执行失败 ，其后的命令仍然会被执行，没有回滚。</li>
</ul>
<h4 id="Redis事务和MySQL的事务有什么区别"><a href="#Redis事务和MySQL的事务有什么区别" class="headerlink" title="Redis事务和MySQL的事务有什么区别"></a>Redis事务和MySQL的事务有什么区别</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gjmhome/p/14409390.html">讲解1</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/264354517">讲解2</a></p>
<h4 id="秒杀案例"><a href="#秒杀案例" class="headerlink" title="秒杀案例"></a>秒杀案例</h4><pre class=" language-jsp"><code class="language-jsp"><%@ page language="java" contentType="text/html; charset=UTF-8"  pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Insert title here</title>
   </head>
   <body>
      <h1>iPhone 12 Pro !!!  1元秒杀！！！
      </h1>


      <form id="msform" action="$&#123;pageContext.request.contextPath&#125;/doseckill" enctype="application/x-www-form-urlencoded">
         <input type="hidden" id="prodid" name="prodid" value="0101">
         <input type="button"  id="miaosha_btn" name="seckill_btn" value="秒杀点我"/>
      </form>

   </body>
   <script  type="text/javascript" src="$&#123;pageContext.request.contextPath&#125;/script/jquery/jquery-3.1.0.js"></script>
   <script  type="text/javascript">
      $(function()&#123;
         $("#miaosha_btn").click(function()&#123;     
            var url=$("#msform").attr("action");
            $.post(url,$("#msform").serialize(),function(data)&#123;
               if(data=="false")&#123;
                  alert("抢光了" );
                  $("#miaosha_btn").attr("disabled",true);
               &#125;
            &#125; );    
         &#125;)
      &#125;)
   </script>
</html>
</code></pre>
<p>serlvet</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 秒杀案例
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecKillServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 1L<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token function">SecKillServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

      String userid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">""</span> <span class="token punctuation">;</span>
      String prodid <span class="token operator">=</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"prodid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">//        boolean isSuccess=SecKill_redis.doSecKill(userid,prodid);</span>
      <span class="token keyword">boolean</span> isSuccess<span class="token operator">=</span> SecKill_redisByScript<span class="token punctuation">.</span><span class="token function">doSecKill</span><span class="token punctuation">(</span>userid<span class="token punctuation">,</span>prodid<span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>isSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<p>Util</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisPoolUtil</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> JedisPool jedisPool <span class="token operator">=</span> null<span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token function">JedisPoolUtil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> JedisPool <span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">==</span> jedisPool<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
         <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>JedisPoolUtil<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">==</span> jedisPool<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
               JedisPoolConfig poolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               poolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               poolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               poolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               poolConfig<span class="token punctuation">.</span><span class="token function">setBlockWhenExhausted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               poolConfig<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// ping  PONG</span>

               jedisPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPool</span><span class="token punctuation">(</span>poolConfig<span class="token punctuation">,</span> <span class="token string">"192.168.130.172"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">,</span> <span class="token number">60000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
         <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> jedisPool<span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span>JedisPool jedisPool<span class="token punctuation">,</span> Jedis jedis<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">!=</span> jedis<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
         jedisPool<span class="token punctuation">.</span><span class="token function">returnResource</span><span class="token punctuation">(</span>jedis<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
   <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecKill_redis</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Jedis jedis <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.1.190"</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//秒杀过程</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">doSecKill</span><span class="token punctuation">(</span>String uid<span class="token punctuation">,</span>String prodid<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//1 uid和prodid非空判断</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>uid <span class="token operator">==</span> null <span class="token operator">||</span> prodid <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//2 连接redis</span>
        <span class="token comment" spellcheck="true">//Jedis jedis = new Jedis("192.168.44.168",6379);</span>
        <span class="token comment" spellcheck="true">//通过连接池得到jedis对象</span>
        JedisPool jedisPoolInstance <span class="token operator">=</span> JedisPoolUtil<span class="token punctuation">.</span><span class="token function">getJedisPoolInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Jedis jedis <span class="token operator">=</span> jedisPoolInstance<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//3 拼接key</span>
        <span class="token comment" spellcheck="true">// 3.1 库存key</span>
        String kcKey <span class="token operator">=</span> <span class="token string">"sk:"</span><span class="token operator">+</span>prodid<span class="token operator">+</span><span class="token string">":qt"</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 3.2 秒杀成功用户key</span>
        String userKey <span class="token operator">=</span> <span class="token string">"sk:"</span><span class="token operator">+</span>prodid<span class="token operator">+</span><span class="token string">":user"</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//监视库存</span>
        jedis<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//4 获取库存，如果库存null，秒杀还没有开始</span>
        String kc <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>kcKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>kc <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"秒杀还没有开始，请等待"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 5 判断用户是否重复秒杀操作</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span>userKey<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已经秒杀成功了，不能重复秒杀"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><